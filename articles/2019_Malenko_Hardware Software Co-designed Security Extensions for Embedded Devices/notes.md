<!-- Please prefix the notes with the date as in [22/12/2020] -->

[14/03/2022]

The work focuses on IoT security and especially **low-cost microcontrollers (MCUs)** which operate in a **single physical address space**. The need for isolation at a very low cost is extremely important since some of those MCUs perform security and safety critical operations. 

**Experimental Setup:** The architecture of the solution is based on a RISC-V **`vscale`** implementation on which a minimal microkernel (***SmartOS***) is running. The **`vscale`** processor is a single-issue, three stage pipeline implementation of the RISC-V ISA. It is simple, minimal and has room for extensions. The MCU includes several peripherals which are mapped into a single address space with the memories, and if no memory protection is available, are available to everyone. ***SmartOS*** is a small, modular, real-time operating system suitable for low-cost embedded devices. It uses two operational modes: the kernel runs in privileged machine mode while tasks and libraries run in user mode. The kernel uses its own stack and is responsible for priority-aware scheduling, system call execution, interrupt handling, dynamic resource management and inter-task synchronization with events. The kernel code and data can only be accessed using system calls which are atomic and executed in machine mode. Due to the ***single physical address space*** constraint, the system has to be properly designed and isolated. Task communicate with events which can be invoked by tasks or interrupt service routines (ISRs).

**Implementation Details:** The MPU is configured with four Control and Status Registers (CSRs), which hold the address range of the API functions, called libraries and are not reprogrammed on every context switch. **Basic memory protection** is performed at task creation by specifying the priority, the amount of stack to be used as well as the entry function. When a task is loaded, the kernel assigns unique code and data (including stack) memory regions which are stored in the Task Control Block (TCB). The two privileges proposed by **`vscale`** are used to separate MPU configuration from being modified in user mode. **Peripheral protection** implies that shared peripherals are declared as resources. Tasks request access to a resource and wait for hardware checks to complete to give them access. One CSR is used to protect up to 32 peripherals. **Inter-task communication protection** is implemented using a shared memory approach. The memory region is divided into pages of configurable but mutually equal sizes. The MPU bitfield register has a '1' only if the communication is requested and acknowledged by both sending and receiving tasks. The authentication is performed in machine mode before switching to user mode to send data in a dedicated register and avoid expensive system calls. In hardware, every time a data memory operation is performed in the designated shared memory area for communication, the MPU calculates the page index, checks the `comm_reg` register and raises a data memory access exception if the executing task has no privileges to use the indexed page.


##### tags: embedded system, hardware